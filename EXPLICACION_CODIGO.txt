# EXPLICACIN DEL CDIGO - TEAMHUB

Este documento detalla la estructura y el funcionamiento del c贸digo fuente de TeamHub. El proyecto sigue un patr贸n similar a MVC (Modelo-Vista-Controlador) simplificado para facilitar su mantenimiento y escalabilidad.

##  ESTRUCTURA DE CARPETAS

El proyecto se divide estrictamente en 3 carpetas principales:

1.  **`modelo/`**: (Logica y Datos)
    -   Aqu铆 reside toda la l贸gica de negocio y la interacci贸n con la base de datos.
    -   Contiene scripts de migraci贸n, semillas de datos (seeds) y la clase principal de consultas.

2.  **`motor/`**: (N煤cleo)
    -   Contiene la configuraci贸n base del sistema.
    -   Principalmente, la conexi贸n a la base de datos (Singleton).

3.  **`ui/`**: (Interfaz de Usuario)
    -   Contiene las vistas p煤blicas que ve el usuario (HTML/PHP).
    -   Maneja la recepci贸n de formularios y la presentaci贸n de datos.

---

##  ARCHIVOS CLAVE

### 1. `motor/db.php`
Este archivo maneja la conexi贸n a MySQL usando el patr贸n **Singleton**.
-   **驴Por qu茅?** Para asegurar que solo exista UNA conexi贸n a la base de datos por petici贸n, ahorrando recursos.
-   Usa PDO para mayor seguridad contra inyecciones SQL.

### 2. `modelo/consultas.php`
Es el "cerebro" de la aplicaci贸n. Contiene la clase `Consultas` con todos los m茅todos para:
-   **Autenticaci贸n**: `verificarlogin`, `registrarUsuario`.
-   **Gesti贸n de Equipos**: `obtenerTodosLosEquipos`, `actualizarEstadoEquipo`.
-   **Roles y Permisos**:
    -   `esMiembro($user_id, $team_id)`: Verifica si un usuario pertenece a un equipo.
    -   `obtenerRolUsuario`: Devuelve si es 'admin' (Jefe de Proyecto) o 'member' (Trabajador).
    -   **GHOST ADMIN**: Aqu铆 est谩 la l贸gica del "Super Admin". El m茅todo `esGlobalAdmin` verifica si el usuario tiene rol global 'admin' en la tabla `users`. Si es as铆, se le da acceso total y rol de 'admin' en cualquier proyecto autom谩ticamente, aunque no est茅 en la tabla `team_members`.

### 3. `ui/index.php`
El panel de control principal (Dashboard).
-   **Dise帽o**: Usa CSS Grid no-lineal (Sidebar a la izquierda, Contenido a la derecha).
-   **L贸gica de Renderizado**:
    -   Si eres **Admin** del proyecto seleccionado, muestra el panel de "Gesti贸n del Proyecto" para cambiar el estado.
    -   Si eres **Trabajador**, solo muestra la informaci贸n.
    -   Muestra la lista de miembros con sus roles y estados (Puntos de colores).
-   **Barra Lateral**: Incluye el selector de estado del usuario (Oficina, Teletrabajo, etc.) que env铆a una petici贸n POST para actualizar el estado en tiempo real.

### 4. `modelo/init_db.php`
Script maestro de inicializaci贸n.
-   Lee el archivo `schema.sql`.
-   Resetea la base de datos.
-   Crea el usuario Admin original.
-   Se ejecuta via Docker: `docker compose exec web php modelo/init_db.php`.

---

##  FLUJO DE DATOS

1.  El usuario entra a `ui/inicio.php`.
2.  Env铆a formulario POST.
3.  `consultas.php` verifica credenciales en MySQL.
4.  Si es correcto, crea una `SESSION` y redirige a `ui/index.php`.
5.  En `index.php`, se instancia `Consultas` para pedir los proyectos y los detalles del usuario.
6.  El HTML se renderiza din谩micamente seg煤n los datos recibidos.

##  NOTA SOBRE EL "GHOST ADMIN"

El Admin Global (`admin@teamhub.com`) es especial:
-   Tiene `role = 'admin'` en la tabla `users`.
-   **NO** existe en la tabla `team_members`. por eso no aparece en las listas de miembros UI.
-   Sin embargo, `consultas.php` intercepta sus peticiones y le otorga permisos de jefe (`admin`) en todos los contextos.
